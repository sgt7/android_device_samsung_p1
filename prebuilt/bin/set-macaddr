#!/system/bin/sh

#
# NOTE: this script depends on samsung rild
#
#       /data/.nvmac.info is created by samsung rild
#

if [ -f /data/.nvmac.info ]; then

  # read wlan mac address
  WLMAC=$(cat /data/.nvmac.info)

  # write updated wifi driver config
  cat /system/vendor/firmware/nvram_net.txt | sed "s/macaddr=\([0-9a-fA-F]\{2\}\:\?\)\+/macaddr=$WLMAC/" > /data/.nvram_net.txt
  chown radio.radio /data/.nvram_net.txt
  chmod 0664 /data/.nvram_net.txt

fi

if [ -f /efs/imei/bt.txt ]; then

  # read bluetooth mac address
  BTMAC=$(cat /efs/imei/bt.txt | cut -f2 -d: | sed 's/\(..\)/\1:/g;s/:$//')

  # write bluetooth mac and update path reference
  echo -n $BTMAC > /data/.nvram_btmac
  chown bluetooth.bluetooth /data/.nvram_btmac
  chmod 0664 /data/.nvram_btmac
  setprop ro.bt.bdaddr_path /data/.nvram_btmac

fi
